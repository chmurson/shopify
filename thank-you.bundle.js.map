{"version":3,"sources":["webpack:///./src/thank-you.js","webpack:///./~/jquery-deparam/jquery-deparam.js","webpack:///./src/pay-u/index.js","webpack:///./src/pay-u/config.js","webpack:///./src/thank-you/messages.js"],"names":[],"mappings":"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","file":"thank-you.bundle.js","sourcesContent":["/**\n * Created by wpiat on 03.07.2016.\n */\nimport $ from 'jquery';\nimport {BACKEND_URL} from './env-config';\nimport 'jquery-deparam';\n\nimport {startOrderFetching, paymentStatuses} from './pay-u';\nimport * as messages from './thank-you/messages'\n\nconst checkout_token = Shopify.checkout.token;\n//const checkout_token = \"0975fe6fc798dc6ef50b0ee4b9ac494a\";\n\nprocessOrder();\n\nfunction processOrder() {\n  startOrderFetching(checkout_token)\n    .then(showOrderInfo)\n    .catch(infoServerError)\n    .then(turnOffDefaultLoadingScreen);\n}\n\nconst paymentStatusToShowInfo = {\n  [undefined]: createdInfo,\n  [paymentStatuses.CREATED]: createdInfo,\n  [paymentStatuses.PENDING]: pendingInfo,\n  [paymentStatuses.WAITING_FOR_CONFIRMATION]: waitForConfirmationInfo,\n  [paymentStatuses.REJECTED]: rejectedInfo,\n  [paymentStatuses.CANCELED]: canceledInfo,\n  [paymentStatuses.COMPLETED]: completedInfo\n};\n\n\n/**\n * @param {Order} order\n */\nfunction showOrderInfo(order) {\n  if (hasOrderAnError()) {\n    return infoSomeError();\n  }\n  if (order.cancelled_at) {\n    return; //do nothing order is cancelled\n  }\n  if (order.isPayU === false) {\n    return; //do nothing if it's not PayU\n  }\n  const infoAction = paymentStatusToShowInfo[order.status];\n  infoAction.call();\n}\n\n\n/**\n * ACTIONS\n */\nfunction infoSomeError() {\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createSomeError());\n}\nfunction infoServerError() {\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createServerError());\n}\nfunction createdInfo() {\n  const url = getPayUStartUrl(checkout_token);\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createCreatedMessage(url));\n\n  $('#navigate-to-payu').on('click', function () {\n    window.clearTimeout(timer); //to prevent duplication of requests\n  });\n  const timer = setTimeout(()=> {\n    location.href = url;\n  }, 5000);\n}\nfunction rejectedInfo() {\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createRejectedMessage());\n}\nfunction completedInfo() {\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createCompletedMessage());\n}\nfunction pendingInfo() {\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createPendingMessage());\n}\nfunction canceledInfo() {\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createCanceledMessage());\n}\nfunction waitForConfirmationInfo() {\n  Shopify.Checkout.OrderStatus.addContentBox(messages.createWaitingForConfirmationMessage());\n}\n/**\n * ACTIONS END\n */\n\n/**\n * turn off default css loading screen\n */\nfunction turnOffDefaultLoadingScreen() {\n  $('.page--thank-you .main__content > .section > .section__content').addClass('loaded');\n}\n\n/**\n * @param order\n * @returns {boolean}\n */\nfunction hasOrderAnError() {\n  const questionMarkPos = location.href.indexOf('?');\n  if (questionMarkPos === -1) {\n    return false;\n  }\n  const params = $.deparam(location.href.slice(questionMarkPos + 1));\n  if (!params || params.error !== \"true\") {\n    return false;\n  }\n  return true;\n}\n\nfunction getPayUStartUrl(checkout_token) {\n  return `${BACKEND_URL}/order-payu-start/${checkout_token}`;\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/thank-you.js\n **/","(function(deparam){\n    if (typeof require === 'function' && typeof exports === 'object' && typeof module === 'object') {\n        try {\n            var jquery = require('jquery');\n        } catch (e) {\n        }\n        module.exports = deparam(jquery);\n    } else if (typeof define === 'function' && define.amd){\n        define(['jquery'], function(jquery){\n            return deparam(jquery);\n        });\n    } else {\n        var global;\n        try {\n          global = (false || eval)('this'); // best cross-browser way to determine global for < ES5\n        } catch (e) {\n          global = window; // fails only if browser (https://developer.mozilla.org/en-US/docs/Web/Security/CSP/CSP_policy_directives)\n        }\n        global.deparam = deparam(global.jQuery); // assume jQuery is in global namespace\n    }\n})(function ($) {\n    var deparam = function( params, coerce ) {\n        var obj = {},\n        coerce_types = { 'true': !0, 'false': !1, 'null': null };\n\n        // Iterate over all name=value pairs.\n        params.replace(/\\+/g, ' ').split('&').forEach(function(v){\n            var param = v.split( '=' ),\n            key = decodeURIComponent( param[0] ),\n            val,\n            cur = obj,\n            i = 0,\n\n            // If key is more complex than 'foo', like 'a[]' or 'a[b][c]', split it\n            // into its component parts.\n            keys = key.split( '][' ),\n            keys_last = keys.length - 1;\n\n            // If the first keys part contains [ and the last ends with ], then []\n            // are correctly balanced.\n            if ( /\\[/.test( keys[0] ) && /\\]$/.test( keys[ keys_last ] ) ) {\n                // Remove the trailing ] from the last keys part.\n                keys[ keys_last ] = keys[ keys_last ].replace( /\\]$/, '' );\n\n                // Split first keys part into two parts on the [ and add them back onto\n                // the beginning of the keys array.\n                keys = keys.shift().split('[').concat( keys );\n\n                keys_last = keys.length - 1;\n            } else {\n                // Basic 'foo' style key.\n                keys_last = 0;\n            }\n\n            // Are we dealing with a name=value pair, or just a name?\n            if ( param.length === 2 ) {\n                val = decodeURIComponent( param[1] );\n\n                // Coerce values.\n                if ( coerce ) {\n                    val = val && !isNaN(val) && ((+val + '') === val) ? +val        // number\n                    : val === 'undefined'                       ? undefined         // undefined\n                    : coerce_types[val] !== undefined           ? coerce_types[val] // true, false, null\n                    : val;                                                          // string\n                }\n\n                if ( keys_last ) {\n                    // Complex key, build deep object structure based on a few rules:\n                    // * The 'cur' pointer starts at the object top-level.\n                    // * [] = array push (n is set to array length), [n] = array if n is\n                    //   numeric, otherwise object.\n                    // * If at the last keys part, set the value.\n                    // * For each keys part, if the current level is undefined create an\n                    //   object or array based on the type of the next keys part.\n                    // * Move the 'cur' pointer to the next level.\n                    // * Rinse & repeat.\n                    for ( ; i <= keys_last; i++ ) {\n                        key = keys[i] === '' ? cur.length : keys[i];\n                        cur = cur[key] = i < keys_last\n                        ? cur[key] || ( keys[i+1] && isNaN( keys[i+1] ) ? {} : [] )\n                        : val;\n                    }\n\n                } else {\n                    // Simple key, even simpler rules, since only scalars and shallow\n                    // arrays are allowed.\n\n                    if ( Object.prototype.toString.call( obj[key] ) === '[object Array]' ) {\n                        // val is already an array, so push on the next value.\n                        obj[key].push( val );\n\n                    } else if ( {}.hasOwnProperty.call(obj, key) ) {\n                        // val isn't an array, but since a second value has been specified,\n                        // convert val into an array.\n                        obj[key] = [ obj[key], val ];\n\n                    } else {\n                        // val is a scalar.\n                        obj[key] = val;\n                    }\n                }\n\n            } else if ( key ) {\n                // No value was defined, so set something meaningful.\n                obj[key] = coerce\n                ? undefined\n                : '';\n            }\n        });\n\n        return obj;\n    };\n    if ($) {\n      $.prototype.deparam = $.deparam = deparam;\n    }\n    return deparam;\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/jquery-deparam/jquery-deparam.js\n ** module id = 113\n ** module chunks = 2\n **/","import $ from 'jquery';\nimport {BACKEND_URL} from './../env-config'\nimport {maxAttemptNumber, getOrderTimeoutBeforeNextAttempt, PAY_U_GATWAY} from './config';\n\n/**\n * @param orderNumber\n * @returns {Promise}\n */\nexport function getOrder(checkoutToken) {\n  return $.getJSON(`${BACKEND_URL}/order/${checkoutToken}`)\n    .then(orders=> {\n      if (typeof orders === \"string\") {\n        orders = JSON.parse(orders);\n      }\n      if (orders[0]) {\n        return new Order(orders[0]);\n      }\n      return $.Deferred().reject(\"No order has been found\");\n    });\n}\n\n/**\n * @param checkoutToken\n * @returns {Promise}\n */\nexport function startOrderFetching(checkoutToken) {\n  return new Promise((resolve, reject)=> {\n    let attemptCount = 0;\n    _getOrderAttempt();\n    function _getOrderAttempt() {\n      attemptCount++;\n      if (attemptCount > maxAttemptNumber) {\n        return reject();\n      }\n      getOrder(checkoutToken)\n        .then(order=> {\n          resolve(order)\n        }, ()=> {\n          setTimeout(()=>_getOrderAttempt(), getOrderTimeoutBeforeNextAttempt);\n        })\n\n    }\n  });\n}\n\nexport const paymentStatuses = {\n  CREATED: \"CREATED\",\n  COMPLETED: \"COMPLETED\",\n  REJECTED: \"REJECTED\",\n  CANCELED: \"CANCELED\",\n  PENDING: \"PENDING\",\n  WAITING_FOR_CONFIRMATION: \"WAITING_FOR_CONFIRMATION\"\n};\n\nexport class Order {\n  constructor(data) {\n    this.checkout_token = null;\n    this.gateway = null;\n    Object.assign(this, data);\n  }\n\n  get isPayU() {\n    return this.gateway === PAY_U_GATWAY;\n  }\n\n  get status() {\n    return (this.payU) ? (this.payU.status) : undefined;\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/pay-u/index.js\n **/","export const PAY_U_GATWAY = \"PayU\";\nexport const maxAttemptNumber = 5;\nexport const getOrderTimeoutBeforeNextAttempt = 2500;\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/pay-u/config.js\n **/","/**\n * When _expect_ to get info about order from _our_ servers but we can't for some reason\n * @param refreshUrl\n * @returns {string}\n */\nexport function createServerError() {\n  return `\n    <h2 class=\"os-step__title error\">Błąd serwera</h2>\n    <p class=\"error\">Nie mogliśmy połączyć się z serwerem przez co nie wiemy jaki jest status płatności PayU.\n      Spróbuj za chwilę odświerzyć stronę. Możliwe, że to tylko chwilowe problemy. Jeśli problem nie ustępuje, \n      skontaktuj się z nami.\n    </p>\n    <p><a href=\"${window.location.href}\">Spróbuj jeszcze raz</a></p>\n  `;\n}\n\n/**\n * When any other error appears. Like error message from PayU, or wrong data about order status\n * @returns {string}\n */\nexport function createSomeError() {\n  const url = window.location.href.split('?')[0];\n\n  return `\n    <h2 class=\"os-step__title error\">Błąd serwera</h2>\n    <p>W trakcie przetwarzania transakcji PayU wystąpił błąd.</p>\n    <p>Kliknij <a href=\"${url}\">tutaj</a>, aby spróbować jeszcze raz.</p>\n    <p>Jeśli problem nie ustąpi, skontaktuj się z nami.</p>\n  `;\n}\n\n/**\n * for order with CREATED status\n * @param payUUrl\n * @returns {string}\n */\nexport function createCreatedMessage(payUUrl) {\n  return `\n    <p>Za chwilę zostaniesz przekierowany na strone PayU gdzię będziesz mógł dokonać płatności.</p>\n    <p>Jeśli tak się nie stanie, możesz się przenieść klikając <a id=\"navigate-to-payu\" href=\"${payUUrl}\">tutaj</a></p>    \n  `;\n}\n\n/**\n * for order with REJECTED status\n * @returns {string}\n */\nexport function createRejectedMessage() {\n  return `\n    <h2 class=\"os-step__title error\">Płatność została odrzucona</h2>\n    <p>Płatność została odrzucona, ale prawdopodobnie Twoje konto zostało obciążone. W razie wątpliwości prosimy o kontakt.</p>\n  `;\n}\n\n/**\n * for order with COMPLETED status\n * @returns {string}\n */\nexport function createCompletedMessage() {\n  return `\n    <p>Płatność za zamowienie została zakceptowana. Dziękujemy.</p>\n  `;\n}\n\n/**\n * for order with CANCELED status\n * @returns {string}\n */\nexport function createCanceledMessage() {\n  return `\n    <h2 class=\"os-step__title error\">Płatność została anulowana</h2>\n    <p>Płatność została anulowana, Twoje konto nie zostało obciążone. W razie wątpliwości prosimy o kontakt.</p>\n  `;\n}\n\n/**\n * for order with WAITING_FOR_CONFIRMATION status\n * @returns {string}\n */\nexport function createWaitingForConfirmationMessage() {\n  return `\n    <p>Płatność wymaga potwierdzenia. W razie wątpliwości prosimy o kontakt.</p>\n  `;\n}\n\n/**\n * for order with WAITING_FOR_CONFIRMATION status\n * @returns {string}\n */\nexport function createPendingMessage() {\n  return `\n    <p>Płatność jest w trakcie rozliczenia.</p>\n  `;\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/thank-you/messages.js\n **/"],"sourceRoot":""}